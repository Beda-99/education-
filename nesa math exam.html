<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P6 National Mathematics Exam | Official Portal</title>
    <link rel="icon" href="logo.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0055a5; --danger: #dc2626; --success: #10b981; --bg: #f8fafc; }
        * { box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; }

        /* THE RED ALERT OVERLAY (Visible when cheating) */
        #cheatingOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 10000; flex-direction: column; justify-content: center; 
            align-items: center; text-align: center; border: 25px solid var(--danger);
        }
        .red-alert { color: var(--danger); font-size: 4rem; font-weight: 800; margin: 0; text-transform: uppercase; }

        /* INSTRUCTIONS PAGE (Step 1) */
        #instructionPage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9000; display: flex; justify-content: center; align-items: center;
        }
        .inst-card { background: white; padding: 40px; border-radius: 20px; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 10px solid var(--primary); text-align: center; }

        /* EXAM LAYOUT */
        .exam-header { background: var(--primary); color: white; padding: 15px 5%; position: sticky; top: 0; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .timer-box { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 8px; font-weight: 800; font-size: 1.2rem; border: 1px solid white; }
        .container { max-width: 850px; margin: 30px auto; padding: 20px; }
        .q-card { background: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; border-left: 8px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        
        .btn { padding: 15px 30px; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; width: 100%; margin-top: 20px; }
        .btn-dark { background: #1e293b; color: white; margin-top: 20px; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }
    </style>
</head>
<body>

    <div id="instructionPage">
        <div class="inst-card">
            <h2 style="color: var(--primary);">National Exam Instructions</h2>
            <p>Please read carefully before beginning the session:</p>
            <ul style="text-align: left; line-height: 2; margin-bottom: 25px;">
                <li>This is a <b>Mathematics</b> paper with 40 questions.</li>
                <li>Time Limit: <b>2 Hours</b>.</li>
                <li><b>Rule:</b> Switching tabs or opening other windows will lock your exam.</li>
            </ul>
            <button class="btn btn-primary" onclick="startExam()">ACCEPT & START EXAM</button>
        </div>
    </div>

    <div id="cheatingOverlay">
        <h1 class="red-alert">Exam Terminated</h1>
        <p style="font-size: 1.5rem; color: #475569; max-width: 600px;">
            Violation Detected: You left the examination tab.
        </p>
        <button class="btn btn-dark" onclick="resetExam()">REQUEST RE-ASSESSMENT</button>
        <p style="margin-top: 15px; color: #94a3b8;">Teacher authorization required to continue.</p>
    </div>

    <div id="examBody" style="display: none;">
        <div class="exam-header">
            <div><b>NATIONAL PORTAL:</b> Mathematics P6</div>
            <div class="timer-box" id="timer">02:00:00</div>
        </div>

        <div class="container">
            <form id="quizForm">
                <div id="questionsList"></div>
                <button type="button" class="btn btn-success" onclick="finishExam()">SUBMIT FINAL PAPER</button>
            </form>
        </div>
    </div>

    <div id="resultArea" class="container" style="display: none; text-align: center;">
        <div class="q-card">
            <h1>Official Score</h1>
            <div id="scoreBox" style="font-size: 4rem; color: var(--primary); font-weight: 800;">0%</div>
            <p id="remarkText"></p>
            <button class="btn btn-primary" onclick="location.reload()">Back to Dashboard</button>
        </div>
    </div>

    <script>
        // --- QUESTION DATABASE (40 QUESTIONS) ---
        const questions = [
            { q: "Work out: 450 + 550", o: ["900", "1000", "1100", "1050"], a: 1 },
            { q: "Find the square root of 81.", o: ["7", "8", "9", "12"], a: 2 },
            { q: "What is 20% of 200?", o: ["20", "40", "50", "100"], a: 1 },
            { q: "Find x: 5x = 50", o: ["5", "10", "15", "2"], a: 1 },
            { q: "Calculate Area of a square with 10cm side.", o: ["20cm²", "40cm²", "100cm²", "80cm²"], a: 2 }
        ];

        // Adding placeholder questions to reach 40 for the system
        for(let i=6; i<=40; i++) {
            questions.push({ q: "National Exam Math Question #" + i + ": Solve (100 / 2) + " + i, o: [50+i, 100+i, i, 0], a: 0 });
        }

        let time = 7200; // 2 Hours
        let timerInterval;

        function startExam() {
            document.getElementById('instructionPage').style.display = 'none';
            document.getElementById('examBody').style.display = 'block';
            renderQuestions();
            startTimer();
        }

        function renderQuestions() {
            const list = document.getElementById('questionsList');
            list.innerHTML = questions.map((item, i) => `
                <div class="q-card">
                    <h3>${i+1}. ${item.q}</h3>
                    <div style="text-align: left;">
                        ${item.o.map((opt, oi) => `
                            <label style="display:block; margin: 10px 0; cursor:pointer;">
                                <input type="radio" name="q${i}" value="${oi}"> ${opt}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                let h = Math.floor(time / 3600);
                let m = Math.floor((time % 3600) / 60);
                let s = time % 60;
                document.getElementById('timer').innerText = 
                    `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                if(time <= 0) finishExam();
                time--;
            }, 1000);
        }

        // --- SECURITY: TAB SWITCH DETECTION ---
        window.onblur = function() {
            document.getElementById('cheatingOverlay').style.display = 'flex';
            document.getElementById('examBody').style.display = 'none';
            clearInterval(timerInterval);
        }

        // --- FIXED RE-ASSESSMENT LOGIC ---
        function resetExam() {
            let p = prompt("AUTHORIZATION REQUIRED: Type 'RETRY' to unlock the exam.");
            if(p === "RETRY") {
                // 1. Hide the Red Alert
                document.getElementById('cheatingOverlay').style.display = 'none';
                // 2. Show the Exam again
                document.getElementById('examBody').style.display = 'block';
                // 3. Restart the clock
                startTimer(); 
                alert("Exam Unlocked. Please do not switch tabs again.");
            } else {
                alert("Incorrect Password. Exam remains locked.");
            }
        }

        function finishExam() {
            clearInterval(timerInterval);
            let score = 0;
            const form = new FormData(document.getElementById('quizForm'));
            questions.forEach((item, i) => {
                if(form.get('q'+i) == item.a) score++;
            });

            const percent = Math.round((score / questions.length) * 100);
            document.getElementById('examBody').style.display = 'none';
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('scoreBox').innerText = percent + "%";
            document.getElementById('remarkText').innerText = `Official Result: ${score} out of 40 correct.`;
        }
    </script>
</body>
</html>